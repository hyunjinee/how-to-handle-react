# Redux



리덕스는 가장 많이 사용하는 상태관리 라이브러리로 리덕스를 사용하면 컴포넌트의 상태 업데이트 관련 로직을 다른 파일로 분리시켜서 더욱 효율적으로 관리할 수 있다. 또한 컴포넌트끼리 똑같은 상태를 공유해야 할 때도 여러 컴포넌트를 거치지 않고 손쉽게 상태값을 전달하거나 업데이트 할 수 있다.

리덕스 라이브러리는 전역 상태를 관리할 때 굉장히 효과적이다. 물론 리덕스를 사용하는 것이 유일한 해결책은 아니다. 이전에 배운 contextAPI를 활용해서도 똑같이 작업할 수 있다. 리액트가 릴리즈 되면서 contextAPI가 개선되기 전에는 사용박식이 매우 불편했기 때문에 주로 리덕스를 사용해 전역 상태 관리를 해왔다.
리덕스 미들웨어라는 기능을 제공하여 비동기 작업을 훨씬 효율적으로 해주기도 한다.

상태에ㅓ 어떠한 변화가 필요하면 액션이란 것이 발생한다. 이는 하나의 객체로 표현되는데 액션 객체는 다음과 같은 형식으로 이루어져있다.
```{
    type: "TOGGLLE_VALUE"
}

```

액션 객체는 type 필드를 반드시 가지고 있어야한다. 이 값을 액션의 이름이라고 생각하면 된다. 그리고 그 외의 값들은 나중에 상태 업데이트를 할 때 참고해야 할 값이며, 작성자 마음대로 넣을 수 있다.

액션 생성 함수는 액션 객체를 만들어 주는 함수이다.

```js
function addTodo(data) {
    return {
        type: 'ADD_TODO',
        data
    }
}

const changeInput = text => ({
    type: 'CHANGE_INPUT',
    text
})
```


어떤 변화를 일으켜야 할 때마다 액션 객체를  만들어야 하는데 매번 액션 객체를 직접 작성하기 번거로울 수 있고, 만드는 과정에서 실수로 정보를 놓칠 수 있다. 이러한 일을 방지하기 위해 이를 함수로 만들어서 관리한다.

리듀서는 변화를 일으키는 함수이다. 액션을 만들어서 발생시켜면 리듀서가 현재 상태와 전달받은 액션 객체를 파라미터로 받아온다. 그리고 두 값을 참고하여 새로운 상태를 만들어서 반환해준다.

```js

const initailState = {
    counter: 1
}

function reducer(state = initialState, action) {
    switch (action.type) {
        case INCREMENT:
            return {
                counter: state.counter + 1

            }
        default: 
        return state
    }   
}
```


스토어
프로젝트에 리덕스를 적용하기 위해 스토어를 만든다. 한개의 프로젝트는 단 하나의 스토어만 가질수 있다. 스토어 안에는 현재 애플리케이션의 상태와 리듀서가 들어가 있으며, 그외에도 몇가지 중요한 내장 함수를 지닌다.

디스패치는 스토어 내장 함수중 하나입니다. 액션을 발생시키는 것이라고 이해하면 된다. 이 함수는 dispatch(action) 과 같은 액션 형태로 액션 객체를 파라미터로 넣어서 호출한다.

이 함수가 호출되면 스토어는 리듀서 함수를 실행시켜서 새로운 상태를 만든다.

구독도 스토어의 내장 함수중 하나이다. subscribe 함수 안에 리스너 함수를 파라미터로 넣어서 호출해 주면, 이 리스너 함수가 액션이 디스패치되어 상태가 업데이트 될 때마다 호출된다. 이 리스너 함수가 액션이 디스패치되어 상태가 업데이트 될 때마다 호출된다.

```js
const listener = () => {
    console.log("업데이트 됨")
}
const unsubscribe = store.subscribe(listener)'

unsubscribe();
```
상태가 업데이트될 대 마다 listener 함수 호출 ㄱㄱ

프로젝트의 상태에 변화를 일으키는 것을 액션이라고 한다. 먼저 액션에 이름을 정의해주고 액션이름은 문자열 형태로 주로 대문자로 작성하며 액션 이름은 고유해야한다. 이름이 중복되면 의도하지 않은 결과가 발생할수 있기 때문이다.

다음으로 이 액션을 사용해서 액션 객체를 만드는 만드는 액션 생성함수를 작성해준다. 액션 객체는 type을 반드시 갖고 있어야 하며, 그 외에 추후 상태를 업데이트할 때 참고하고 싶은 값은 마음대로 넣을 수 있다.

state가 undefined일 때는 initailState를 기본값으로 사용
값이 undefined로 주어지면 initialState를 기본값으로 설정하기 위해 함수의 파라미터 쪽에 기본값이 설정되어 있다.
리듀서에서는 상태의 불변성을 유지하면서 데이터에 변화를 일으켜 주어야한다. 이 작업을 할 때 spread연산자를 사용하면 된다. 객체의 구조가 복잡해지면 스프레드 연산자로 불변성을 관리하며 업데이트 하는 것이 굉장히 번거로울 수 있고, 코드의 가독성도 나빠지기 때문에 리덕스의 상태는 최대한 깊지 않은 구조로 짜는 것이 좋다.

객체의 구조가 복잡해지거나 배열도 함께 다루는 경우 immer라이브러리를 사용하면 좀더 쉽게 리듀서를 작성할 수 있다.
스토어의 상태가 바뀔 때마다 방금 만든 render함수가 호출되도록 해주자. 이 작업은 스토어의 내장함수  subscribe를 사용하여 수행할 수 있다.

subscribe 함수의 파라미터로는 함수 형태의 값을 전달해 준다. 이렇게 전달된 함수는 추후 액션이 발생하여 상태가 업데이트 될 때마다 호출된다.


이 프로젝트에서는 subscribe함수를 사용하지만 리액트 프로젝트에서 리덕스를 사용할 때는 이 함수를 직접 사용하지 않을 것이다. 왜냐하면 컴포넌트에서 리덕스 상태를 조회하는 과정에서 react-redux라는 라이브러리가 이 작업을 대신해 주기 때문이다.


컴포넌트에서 리덕스 상태를 조회할때 react-redux라이브러리 사용

리덕스 프로젝트의 세가지 규칙


> 단일 스토어
> 하나의 애플리케이션 안에는 하나의 스토어가 들어있다. 사실 여러개의 스토어를 사용하는 것이 완전히 불가능하지는 않다. 특정 업데이트가 너무 빈번하게 일어나거나 애플리케이션의 특정 부분을 완전히 분리 시킬 때 여러개의 스토어를 만들수도있지만, 상태 관리가 복잡해질수 있으므로 권장하지 않는다.

> 읽기 전용 상태

리덕스 상태는 읽기 전용이다.기존에 리액트에서 setState를 사용하여 state를 업데이트 할 때도 객체나 배열을 업데이트하는 과정에서 불변성을 지켜주기 위해 spread 연산자를 사용하거나 immer와 같은 불변성을 지켜주는 라이브라이브러리를 사용했다. 리덕스도 마찬가지이다. 상태를 업데이트 할 때 기존의 객체는 건드리지 않고 새로운 객체를 생성해주어야한다.

리덕스에서 불변성을 유지해야 하는 이유는 내부적으로 데이터가 변경되는 것을 탐지하기 위해 얕은 비교 검사를 하기 때문이다. 객체의 변화를 감지할 때 객체의 깊숙한 안쪽까지 비교하는 것이 아니라 겉핥기 식으로 비교하여 좋은 성능을 유지할 수 있다. 리덕스에서 불변성을 유지하는 이유는 내부적으로 데이터가 변경되는 것을 감지하기위해서 얕은 비교를 하기 때문이다. 객체의 변화를 감지할 때 객체의 깊숙한 안쪽 까지 비교하는 것이 아니라 겉핥기 식으로 비교하여 좋은 성능을 유지할수 있는 것이다.

> 리듀서는 순수한 함수이다.

변화를 일으키는 리듀서함수는 순수한 함수여야 한다. 순수한 함수는 다음 조건을 만족한다.
리듀서 함수는 이전 상태와 액션객체를 파라미터로 받는다.
파라미터외의 값에는 의존하면 안된다.
이전 상태는 절대로 건드리지 않고, 변화를 준 새로운 상태 객체를 만들어서 반환한다. 똑같은 파라미터로 호출된 리듀서 함수는 언제나 똑같은 결과 같을 반환해야한다.

리듀서를 작성할 때는 위 네가지 사항을 주의해야한다.예를 들어 리듀서 함수 내부에서 랜덤 값을 만들거나, Date함수를 사용하여 현재 시간을 가져오거나, 네트워크 요청을 한다면 파라미터가 같아도 다른 결과를 만들어 낼 수 있기 때문에 사용하면 안된다. 이러한 작업은 리듀서 함수가 같아도 다른 결과를 만들어 낼 수 있기 때문에 사용하면 안된다. 이러한 작업은 리듀서 함수바깥에서 처리해 주어야한다. 액션을 만드는 과정에서 처리해도 되고, 추후 배울 리덕스 미들웨어에서도 처리해도 된다. 


리덕스 라이브러리가 어떤 방식으로 작동하는지 알아보았다. 

리액트 리덕스 라이브러리를 사용하면 스토어의 상태가 업데이트 될 때마다 컴포넌트를 리렌더링 해준다.
